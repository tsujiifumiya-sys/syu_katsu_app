{% extends "base.html" %}
{% block title %}è‡ªå·±åˆ†æ{% endblock %}

{% block content %}
<div class="page-header">
    <h1>ğŸ” è‡ªå·±åˆ†æ</h1>
    <a href="{{ url_for('main.self_analysis_new') }}" class="btn btn-primary">+ æ–°è¦è¿½åŠ </a>
</div>

<div class="analysis-tabs" id="analysisTabs">
    {% for cat in categories %}
    <button class="tab-btn {% if loop.first %}active{% endif %}" data-tab="{{ cat }}">{{ cat }}</button>
    {% endfor %}
</div>

{% for cat in categories %}
<div class="tab-content {% if loop.first %}active{% endif %}" id="tab-{{ cat }}">
    {% if analyses[cat] %}
    <div class="analysis-cards">
        {% for sa in analyses[cat] %}
        <div class="analysis-card">
            <div class="analysis-header">
                <span class="version-badge">v{{ sa.version }}</span>
                <span class="text-muted">{{ sa.created_at.strftime('%Y/%m/%d') if sa.created_at else '' }}</span>
                <div class="analysis-actions">
                    <a href="{{ url_for('main.self_analysis_edit', sa_id=sa.id) }}" class="btn btn-sm btn-ghost">âœï¸</a>
                    <form method="POST" action="{{ url_for('main.self_analysis_delete', sa_id=sa.id) }}"
                        class="inline-form" onsubmit="return confirm('å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')">
                        <button type="submit" class="btn btn-sm btn-danger-ghost">ğŸ—‘ï¸</button>
                    </form>
                </div>
            </div>
            <div class="analysis-content">
                <p>{{ sa.content }}</p>
            </div>
            <div class="analysis-footer">
                <span class="char-count">{{ sa.content|length }} å­—</span>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="empty-state">
        <span class="empty-icon">âœï¸</span>
        <p>ã€Œ{{ cat }}ã€ã¯ã¾ã ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“</p>
        <a href="{{ url_for('main.self_analysis_new') }}" class="btn btn-primary btn-sm">è¿½åŠ ã™ã‚‹</a>
    </div>
    {% endif %}
</div>
{% endfor %}
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const tabs = document.querySelectorAll('.tab-btn');
        const contents = document.querySelectorAll('.tab-content');

        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                tabs.forEach(t => t.classList.remove('active'));
                contents.forEach(c => c.classList.remove('active'));
                tab.classList.add('active');
                document.getElementById('tab-' + tab.dataset.tab).classList.add('active');
            });
        });
    });
</script>
{% endblock %}