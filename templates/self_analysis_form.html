{% extends "base.html" %}
{% block title %}{% if analysis %}自己分析を編集{% else %}自己分析を追加{% endif %}{% endblock %}

{% block content %}
<div class="page-header">
    <a href="{{ url_for('main.self_analysis_list') }}" class="back-link">← 自己分析一覧</a>
    <h1>{% if analysis %}{{ analysis.category }}を編集 (v{{ analysis.version }}){% else %}自己分析を追加{% endif %}</h1>
</div>

<form method="POST" class="form-card">
    <div class="form-group">
        <label for="category">カテゴリ <span class="required">*</span></label>
        <select name="category" id="category" class="form-control" required {% if analysis %}disabled{% endif %}>
            {% for cat in categories %}
            <option value="{{ cat }}" {% if analysis and analysis.category==cat %}selected{% endif %}>{{ cat }}</option>
            {% endfor %}
        </select>
        {% if analysis %}
        <input type="hidden" name="category" value="{{ analysis.category }}">
        {% endif %}
    </div>

    <div class="form-group" style="margin-top: 1rem;">
        <label for="content">
            内容 <span class="required">*</span>
            <span class="char-counter" id="charCounter"></span>
        </label>
        <textarea name="content" id="content" class="form-control textarea-large" rows="12" required
            placeholder="ここに内容を入力…">{{ analysis.content if analysis else '' }}</textarea>
    </div>

    <div class="form-actions">
        <button type="submit" class="btn btn-primary">{% if analysis %}更新する{% else %}追加する{% endif %}</button>
        <a href="{{ url_for('main.self_analysis_list') }}" class="btn btn-ghost">キャンセル</a>
    </div>
</form>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const content = document.getElementById('content');
        const counter = document.getElementById('charCounter');

        function updateCounter() {
            counter.textContent = `${content.value.length} 字`;
        }

        content.addEventListener('input', updateCounter);
        updateCounter();
    });
</script>
{% endblock %}