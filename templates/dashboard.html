{% extends "base.html" %}
{% block title %}ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰{% endblock %}

{% block content %}
<div class="page-header">
    <h1>ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h1>
    <p class="subtitle">å°±æ´»ã®å…¨ä½“åƒã‚’ä¸€ç›®ã§æŠŠæ¡</p>
</div>

<!-- çµ±è¨ˆã‚«ãƒ¼ãƒ‰ -->
<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-icon" style="background: linear-gradient(135deg, #6366f1, #8b5cf6);">ğŸ¢</div>
        <div class="stat-info">
            <span class="stat-value">{{ stats.total }}</span>
            <span class="stat-label">ç™»éŒ²ä¼æ¥­</span>
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-icon" style="background: linear-gradient(135deg, #3b82f6, #06b6d4);">âš¡</div>
        <div class="stat-info">
            <span class="stat-value">{{ stats.active }}</span>
            <span class="stat-label">é¸è€ƒä¸­</span>
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-icon" style="background: linear-gradient(135deg, #10b981, #34d399);">ğŸ‰</div>
        <div class="stat-info">
            <span class="stat-value">{{ stats.offer }}</span>
            <span class="stat-label">å†…å®š</span>
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-icon" style="background: linear-gradient(135deg, #f59e0b, #fbbf24);">ğŸ“Š</div>
        <div class="stat-info">
            <span class="stat-value">{% if stats.total > 0 %}{{ ((stats.offer / stats.total) * 100) | round(0) | int
                }}%{% else %}â€”{% endif %}</span>
            <span class="stat-label">å†…å®šç‡</span>
        </div>
    </div>
</div>

<!-- ã‚«ãƒ³ãƒãƒ³ãƒœãƒ¼ãƒ‰ -->
<div class="section-header">
    <h2>é¸è€ƒçŠ¶æ³</h2>
    <a href="{{ url_for('main.company_new') }}" class="btn btn-primary">+ ä¼æ¥­ã‚’è¿½åŠ </a>
</div>

<div class="kanban-board">
    {% for status, companies_in_status in kanban.items() %}
    <div class="kanban-column">
        <div class="kanban-header">
            <span class="kanban-title">{{ status }}</span>
            <span class="kanban-count">{{ companies_in_status | length }}</span>
        </div>
        <div class="kanban-cards">
            {% for c in companies_in_status %}
            <a href="{{ url_for('main.company_detail', company_id=c.id) }}" class="kanban-card">
                <div class="kanban-card-title">{{ c.name }}</div>
                <div class="kanban-card-meta">
                    {% if c.industry %}<span class="tag">{{ c.industry }}</span>{% endif %}
                    <span class="preference-stars">{{ 'â˜…' * c.preference }}{{ 'â˜†' * (5 - c.preference) }}</span>
                </div>
            </a>
            {% endfor %}
            {% if not companies_in_status %}
            <div class="kanban-empty">ã¾ã ã‚ã‚Šã¾ã›ã‚“</div>
            {% endif %}
        </div>
    </div>
    {% endfor %}
</div>

<!-- ç›´è¿‘ã®ã‚¤ãƒ™ãƒ³ãƒˆ -->
<div class="section-header" style="margin-top: 2rem;">
    <h2>ç›´è¿‘ã®ã‚¤ãƒ™ãƒ³ãƒˆ</h2>
    <a href="{{ url_for('main.calendar_view') }}" class="btn btn-ghost">ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’è¦‹ã‚‹ â†’</a>
</div>

<div class="upcoming-events">
    {% for ev in upcoming %}
    <div class="event-card">
        <div class="event-date">
            <span class="event-month">{{ ev.start_at.strftime('%m') }}æœˆ</span>
            <span class="event-day">{{ ev.start_at.strftime('%d') }}</span>
        </div>
        <div class="event-info">
            <span class="event-title">{{ ev.title }}</span>
            <span class="event-meta">
                <span class="event-type-badge">{{ ev.event_type }}</span>
                {% if ev.company %} Â· {{ ev.company.name }}{% endif %}
                Â· {{ ev.start_at.strftime('%H:%M') }}
            </span>
        </div>
    </div>
    {% endfor %}
    {% if not upcoming %}
    <div class="empty-state">
        <span class="empty-icon">ğŸ“…</span>
        <p>ç›´è¿‘ã®äºˆå®šã¯ã‚ã‚Šã¾ã›ã‚“</p>
        <a href="{{ url_for('main.calendar_view') }}" class="btn btn-primary btn-sm">ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¿½åŠ </a>
    </div>
    {% endif %}
</div>

<!-- ESç· åˆ‡ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆ -->
<div class="section-header" style="margin-top: 2rem;">
    <h2>ğŸ“ ESç· åˆ‡ãŒè¿‘ã„</h2>
    <a href="{{ url_for('main.es_list') }}" class="btn btn-ghost">ESä¸€è¦§ â†’</a>
</div>

<div class="es-deadline-grid">
    {% for es in es_deadlines %}
    {% set days_left = (es.deadline - today).days %}
    <div
        class="es-deadline-card {% if days_left <= 3 %}deadline-critical{% elif days_left <= 7 %}deadline-warning{% endif %}">
        <div class="es-deadline-top">
            <span class="tag">{{ es.company.name }}</span>
            <span class="es-days-left {% if days_left <= 3 %}urgent{% elif days_left <= 7 %}soon{% endif %}">
                {% if days_left < 0 %} {{ -days_left }}æ—¥è¶…é {% elif days_left==0 %} ä»Šæ—¥ {% elif days_left==1 %} æ˜æ—¥ {% else
                    %} ã‚ã¨{{ days_left }}æ—¥ {% endif %} </span>
        </div>
        <div class="es-deadline-question">{{ es.question[:60] }}{% if es.question|length > 60 %}â€¦{% endif %}</div>
        <div class="es-deadline-bottom">
            <span class="text-muted">{{ es.deadline.strftime('%m/%d') }} ç· åˆ‡</span>
            {% if es.char_limit %}
            <span class="char-count {% if es.answer|length > es.char_limit %}over-limit{% endif %}">
                {{ es.answer|length }}/{{ es.char_limit }}å­—
            </span>
            {% endif %}
        </div>
    </div>
    {% endfor %}
    {% if not es_deadlines %}
    <div class="empty-state" style="grid-column: 1 / -1;">
        <span class="empty-icon">âœ…</span>
        <p>æœªæå‡ºã®ESã¯ã‚ã‚Šã¾ã›ã‚“</p>
    </div>
    {% endif %}
</div>
{% endblock %}