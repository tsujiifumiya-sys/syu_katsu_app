{% extends "base.html" %}
{% block title %}ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰{% endblock %}

{% block content %}
<div class="page-header">
    <h1>ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h1>
    <p class="subtitle">å°±æ´»ã®å…¨ä½“åƒã‚’ä¸€ç›®ã§æŠŠæ¡</p>
</div>

<!-- 1. ç›´è¿‘ã®ã‚¤ãƒ™ãƒ³ãƒˆ -->
<div class="section-header">
    <h2>ğŸ“… ç›´è¿‘ã®ã‚¤ãƒ™ãƒ³ãƒˆ</h2>
    <a href="{{ url_for('main.calendar_view') }}" class="btn btn-ghost">ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’è¦‹ã‚‹ â†’</a>
</div>

<div class="upcoming-events">
    {% for ev in upcoming %}
    <div class="event-card">
        <div class="event-date">
            <span class="event-month">{{ ev.start_at.strftime('%m') }}æœˆ</span>
            <span class="event-day">{{ ev.start_at.strftime('%d') }}</span>
        </div>
        <div class="event-info">
            <span class="event-title">{{ ev.title }}</span>
            <span class="event-meta">
                <span class="event-type-badge event-type-{{ ev.event_type }}">{{ ev.event_type }}</span>
                {% if ev.company %} Â· {{ ev.company.name }}{% endif %}
                {% if ev.start_at.strftime('%H:%M') != '00:00' %} Â· {{ ev.start_at.strftime('%H:%M') }}{% endif %}
            </span>
        </div>
    </div>
    {% endfor %}
    {% if not upcoming %}
    <div class="empty-state">
        <span class="empty-icon">ğŸ“…</span>
        <p>ç›´è¿‘ã®äºˆå®šã¯ã‚ã‚Šã¾ã›ã‚“</p>
        <a href="{{ url_for('main.calendar_view') }}" class="btn btn-primary btn-sm">ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¿½åŠ </a>
    </div>
    {% endif %}
</div>

<!-- 2. ESç· åˆ‡ãŒè¿‘ã„ï¼ˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®ã€ŒESç· ã‚åˆ‡ã‚Šã€ç¨®åˆ¥ã‹ã‚‰å–å¾—ï¼‰ -->
<div class="section-header" style="margin-top: 2rem;">
    <h2>ğŸ“ ESç· åˆ‡ãŒè¿‘ã„</h2>
    <a href="{{ url_for('main.calendar_view') }}" class="btn btn-ghost">ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’è¦‹ã‚‹ â†’</a>
</div>

<div class="upcoming-events">
    {% for ev in es_events %}
    {% set days_left = (ev.start_at.date() - today).days %}
    <div
        class="event-card {% if days_left <= 3 %}deadline-critical{% elif days_left <= 7 %}deadline-warning{% endif %}">
        <div class="event-date">
            <span class="event-month">{{ ev.start_at.strftime('%m') }}æœˆ</span>
            <span class="event-day">{{ ev.start_at.strftime('%d') }}</span>
        </div>
        <div class="event-info">
            <span class="event-title">{{ ev.title }}</span>
            <span class="event-meta">
                <span class="es-days-left {% if days_left <= 3 %}urgent{% elif days_left <= 7 %}soon{% endif %}">
                    {% if days_left < 0 %}{{ -days_left }}æ—¥è¶…é{% elif days_left==0 %}ä»Šæ—¥{% elif days_left==1 %}æ˜æ—¥{% else
                        %}ã‚ã¨{{ days_left }}æ—¥{% endif %} </span>
                        {% if ev.start_at.strftime('%H:%M') != '00:00' %} Â· {{ ev.start_at.strftime('%H:%M') }}{% endif
                        %}
                </span>
        </div>
    </div>
    {% endfor %}
    {% if not es_events %}
    <div class="empty-state">
        <span class="empty-icon">âœ…</span>
        <p>ç›´è¿‘ã®ESç· åˆ‡ã¯ã‚ã‚Šã¾ã›ã‚“</p>
    </div>
    {% endif %}
</div>

<!-- 3. ç™»éŒ²ä¼æ¥­ä¸€è¦§ -->
<div class="section-header" style="margin-top: 2rem;">
    <h2>ğŸ¢ ç™»éŒ²ä¼æ¥­ä¸€è¦§ï¼ˆ{{ companies|length }}ç¤¾ï¼‰</h2>
    <a href="{{ url_for('main.company_new') }}" class="btn btn-primary">+ ä¼æ¥­ã‚’è¿½åŠ </a>
</div>

{% if not companies %}
<div class="empty-state">
    <span class="empty-icon">ğŸ¢</span>
    <p>ã¾ã ä¼æ¥­ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“</p>
    <a href="{{ url_for('main.company_new') }}" class="btn btn-primary btn-sm">ä¼æ¥­ã‚’è¿½åŠ </a>
</div>
{% else %}
{% set group_icons = {"ã‚¨ãƒ³ãƒˆãƒªãƒ¼å‰": "ğŸ“‹", "æ›¸é¡é¸è€ƒå‰": "ğŸ“", "é©æ€§æ¤œæŸ»å‰": "ğŸ§ª", "ãã‚Œä»¥å¤–": "ğŸ”„"} %}
{% for group_name, group_companies in company_groups.items() %}
{% if group_companies %}
<div class="company-group" style="margin-bottom: 1.5rem;">
    <h3 class="company-group-title">{{ group_icons[group_name] }} {{ group_name }}ï¼ˆ{{ group_companies|length }}ç¤¾ï¼‰</h3>
    <div class="company-list-dashboard">
        {% for c in group_companies %}
        <a href="{{ url_for('main.company_detail', company_id=c.id) }}" class="company-row-card">
            <div class="company-row-main">
                <span class="company-row-name">{{ c.name }}</span>
                <span class="preference-stars">{{ 'â˜…' * c.preference }}{{ 'â˜†' * (5 - c.preference) }}</span>
            </div>
            <div class="company-row-meta">
                {% if c.industry %}<span class="tag">{{ c.industry }}</span>{% endif %}
                <span class="company-status-badge status-{{ c.status_label }}">{{ c.status_label }}</span>
            </div>
        </a>
        {% endfor %}
    </div>
</div>
{% endif %}
{% endfor %}
{% endif %}
{% endblock %}